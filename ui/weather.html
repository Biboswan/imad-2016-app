<!doctype html>
<html>
<head>
   <title>weather.api</title> 
   <link rel="icon" href="/logoB" type="image/x-icon">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <link href="/ui/style.css" rel="stylesheet" />
      <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
       <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdn.rawgit.com/yahoo/xss-filters/master/dist/xss-filters.js"></script>
            <script type="text/javascript">
            var cname,i,api;
            function getapi()
            {
              request= new XMLHttpRequest();
              request.onreadystatechange=function()
            {
             if(request.readyState===XMLHttpRequest.DONE)
           {
             if(request.status===200)
             {
               api=request.responseText;
             }
             else
             {
              alert('dataservice not available presently')
             }
            }
          }
          request.open('GET','/apikey',true);
          request.send(null);
        }
           getapi();
            function getlocationkey(){
            var city=document.getElementById('city');
            var citylist=document.getElementById('citylist');
            citylist.innerHTML='';
            cname = city.value;console.log(cname);
            $.ajax({
             type:"GET",
              url:'http://dataservice.accuweather.com/locations/v1/cities/autocomplete?q='+cname+'&apikey='+api+'&details=true&language=en-us',
          
              dataType: "jsonp",
              success:function parse_response(data){
            console.log('called');
           var length=data.length;
          console.log(data[0].LocalizedName);
      for(i=0;i<length;i++)
      {
      citylist.innerHTML+=`<option value=${data[i].LocalizedName}>${data[i].Key}<option>`;
      }
    }
               });
          
       }      
       function getweather() {
        cname=document.getElementById('city').value;
        var citylist=document.getElementById('citylist');
        length=citylist.options.length;
        for(i=0;i<length;i++){
          if(cname===citylist.options[i].value){
            var key=citylist.options[i].innerHTML;break;
          }
       }
       $.ajax({
             type:"GET",
              url:'http://dataservice.accuweather.com/currentconditions/v1/'+key+'?apikey='+api+'&details=true&language=en-us&getphotos=true',
              dataType: "jsonp",
              success:function parse_response(data){
                document.getElementById('weathericon').src=data[0].Photos[0].PortraitLink;
                var DyoN;
                if(data[0].IsDayTime){
                 DyoN='Day';
                }
               else{
                DyoN='Night'
              }
               document.getElementById('IsDayTime').innerHTML=  'Day/Night        : '+DyoN;
               document.getElementById('WeatherText').innerHTML='Weather          : '+data[0].WeatherText;
               document.getElementById('Temperature.Metric.Value').innerHTML='Temperature      : '+data[0].Temperature.Metric.Value+' C';
               document.getElementById('DewPoint').innerHTML='DewPoint         :'+data[0].DewPoint.Metric.Value+' C';
               document.getElementById('UVIndexText').innerHTML='UVIndex         :'+data[0].UVIndexText;
               document.getElementById('Pressure.Metric.Value').innerHTML='Pressue         :'+data[0].Pressure.Metric.Value+' mb';
               document.getElementById('PressureTendency.LocalizedText').innerHTML='PressureTendency:'+data[0].PressureTendency.LocalizedText;
               document.getElementById('PrecipitationSummary.Past24Hours').innerHTML='Precipitation(Past24Hours):'+data[0].PrecipitationSummary.Past24Hours.Metric.Value+' mm';

              }
             });
          }
    </script>
</head>
<body onload=loading() >
         <img id="loader" src="/logoB" class="mg-circle img-responsive"/>
         <div id="pseudo-body">
        <div id="commonpart">
           </div>
           <div  class="center text-big">
             Well,after knowing about external apis,weather api used by my smartphone influenced me to use one here itself
           </div>
    <input list="citylist" id="city" type="search" onkeyup=getlocationkey() placeholder="type a city name">
   <datalist id="citylist"></datalist>
   <input type=submit class="btn btn-warning" value=submit onclick=getweather()>
   <div class="center">
   <img id="weathericon"  style="height:300px">
   <ul style="list-style-type: none">
   <li id="WeatherText"></li>
   <li id="IsDayTime"></li>
   <li id="Temperature.Metric.Value"></li>
   <li id="DewPoint"></li>
   <li id="UVIndexText"></li>
   <li id="Pressure.Metric.Value"></li>
   <li id="PressureTendency.LocalizedText"></li>
   <li id="PrecipitationSummary.Past24Hours"></li>
   </ul>
   </div>
   <div id="comm">
	   </div>
	   <ul class="list-inline">
	   <li id="combutn">
	   </li>
	   <li id='likebutn'></li>
	   </ul>
	   <div class="container">
	       <h2>Comments</h2>
	       <div id="comment-list">
	       </div>
	   </div>
    
   `<footer id="footer" class="footerbg">
      </footer>
   </div>
   <script type="text/javascript" src="/ui/main"></script>
</body>
</html>
